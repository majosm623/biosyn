<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendamiento de Citas</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/agenda.css">
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-calendar-alt"></i> Disponibilidad de Médicos</h1>
        
        <div class="doctor-selector">
            <div>
                <h3>Especialidad:</h3>
                <select id="specialty-select">
                    <option value="">Todas las especialidades</option>
                    <option value="Cardiología">Cardiología</option>
                    <option value="Pediatría">Pediatría</option>
                    <option value="Ortopedia">Ortopedia</option>
                    <option value="Dermatología">Dermatología</option>
                    <option value="Ginecología">Ginecología</option>
                    <option value="Neurología">Neurología</option>
                    <option value="Oftalmología">Oftalmología</option>
                    <option value="Psiquiatría">Psiquiatría</option>
                    <option value="Endocrinología">Endocrinología</option>
                    <option value="Gastroenterología">Gastroenterología</option>
                    <option value="Oncología">Oncología</option>
                    <option value="Neumología">Neumología</option>
                    <option value="Urología">Urología</option>
                    <option value="Medicina Interna">Medicina Interna</option>
                    <option value="Cirugía Plástica">Cirugía Plástica</option>
                </select>
            </div>

            <div>
                <h3>Médico:</h3>
                <select id="doctor-select">
                    <option value="">Seleccione un médico</option>
                </select>
            </div>
        </div>
        
        <div class="calendar">
            <div class="month-header">
                <button id="prev-month"><i class="fas fa-chevron-left"></i></button>
                <div class="month-title" id="month-title">Mes Año</div>
                <button id="next-month"><i class="fas fa-chevron-right"></i></button>
            </div>
            <div class="weekdays">
                <div class="weekday">Dom</div>
                <div class="weekday">Lun</div>
                <div class="weekday">Mar</div>
                <div class="weekday">Mié</div>
                <div class="weekday">Jue</div>
                <div class="weekday">Vie</div>
                <div class="weekday">Sáb</div>
            </div>
            <div class="days" id="days-container"></div>
        </div>
        
        <div id="time-slots-container" class="time-slots-container">
            <h2 id="selected-date-header"></h2>
            <div class="time-period">
                <h3><i class="fas fa-sun"></i> Turno Mañana (7:00 - 12:00)</h3>
                <div id="morning-slots" class="time-grid"></div>
            </div>
            
            <div class="time-period">
                <h3><i class="fas fa-moon"></i> Turno Tarde (14:00 - 18:00)</h3>
                <div id="afternoon-slots" class="time-grid"></div>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color available-legend"></div>
                    <span>Disponible</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color unavailable-legend"></div>
                    <span>No disponible</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color booked-legend"></div>
                    <span>Reservado</span>
                </div>
            </div>
        </div>
    </div>
    <div style="margin-top: 20px; text-align: center;">
    <button id="confirm-btn" class="confirm-button">
        <i class="fas fa-calendar-check"></i> Confirmar Cita
    </button>
</div>

    <script>
        // Datos simulados de médicos por especialidad
const doctorsBySpecialty = {
  Cardiología: ['Dr. Pérez', 'Dra. Gómez'],
  Pediatría: ['Dr. Morales', 'Dra. Ruiz'],
  Ortopedia: ['Dr. Sánchez'],
  Dermatología: ['Dra. López'],
  // ... agrega más si quieres
  '': ['Dr. Pérez', 'Dra. Gómez', 'Dr. Morales', 'Dra. Ruiz', 'Dr. Sánchez', 'Dra. López'] // todos
};

// Simulación de disponibilidad: para demo, los horarios impares no están disponibles
const simulateAvailability = (doctor, dateStr) => {
  // dateStr en formato 'YYYY-MM-DD'
  // Genera slots con disponibilidad aleatoria simple
  const morningSlots = ['07:00', '07:15', '07:30', '07:45', '08:00', '08:15', '08:30', '08:45', '09:00', '09:15', '09:30', '09:45', '10:00', '10:15', '10:30', '10:45', '11:00', '11:15', '11:30', '11:45'];
  const afternoonSlots = ['14:00', '14:15', '14:30', '14:45', '15:00', '15:15', '15:30', '15:45', '16:00', '16:15', '16:30', '16:45', '17:00', '17:15', '17:30', '17:45'];

  // Simple regla: slots con minutos divisibles entre 30 están disponibles, otros no
  const availableMorning = morningSlots.map(t => {
    const minutes = parseInt(t.split(':')[1], 10);
    return { time: t, available: minutes % 30 === 0 };
  });
  const availableAfternoon = afternoonSlots.map(t => {
    const minutes = parseInt(t.split(':')[1], 10);
    return { time: t, available: minutes % 30 === 0 };
  });

  return { morning: availableMorning, afternoon: availableAfternoon };
};

// Variables globales
let currentDate = new Date();
let selectedDay = null;
let selectedTime = null;

// Referencias DOM
const specialtySelect = document.getElementById('specialty-select');
const doctorSelect = document.getElementById('doctor-select');
const daysContainer = document.getElementById('days-container');
const monthTitle = document.getElementById('month-title');
const prevMonthBtn = document.getElementById('prev-month');
const nextMonthBtn = document.getElementById('next-month');
const morningSlotsContainer = document.getElementById('morning-slots');
const afternoonSlotsContainer = document.getElementById('afternoon-slots');
const selectedDateHeader = document.getElementById('selected-date-header');
const confirmationBox = document.getElementById('confirmation');
const confirmBtn = document.getElementById('confirm-btn');
const selectedSlotInfo = document.getElementById('selected-slot-info');

function fillDoctorOptions() {
  const specialty = specialtySelect.value;
  doctorSelect.innerHTML = '<option value="">Seleccione un médico</option>';
  const doctors = doctorsBySpecialty[specialty] || [];
  doctors.forEach(doc => {
    const option = document.createElement('option');
    option.value = doc;
    option.textContent = doc;
    doctorSelect.appendChild(option);
  });
  clearSelection();
}

function clearSelection() {
  selectedDay = null;
  selectedTime = null;
  morningSlotsContainer.innerHTML = '';
  afternoonSlotsContainer.innerHTML = '';
  selectedDateHeader.textContent = '';
  confirmationBox.style.display = 'none';
  // Clear selected day highlight
  const dayElems = document.querySelectorAll('.day.selected');
  dayElems.forEach(el => el.classList.remove('selected'));
}

function renderCalendar() {
  daysContainer.innerHTML = '';
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();

  // Título Mes Año
  const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
  monthTitle.textContent = `${monthNames[month]} ${year}`;

  // Primer día del mes
  const firstDay = new Date(year, month, 1);
  const startDay = firstDay.getDay(); // domingo=0, lunes=1, ...
  
  // Número de días en el mes
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  // Crear espacios vacíos para que el día 1 quede en su lugar correcto
  for(let i=0; i < startDay; i++) {
    const emptyCell = document.createElement('div');
    emptyCell.classList.add('day', 'disabled');
    daysContainer.appendChild(emptyCell);
  }

  const today = new Date();
  today.setHours(0,0,0,0);

  for(let day=1; day <= daysInMonth; day++) {
    const dayCell = document.createElement('div');
    dayCell.classList.add('day');
    dayCell.textContent = day;
    
    const cellDate = new Date(year, month, day);
    cellDate.setHours(0,0,0,0);

    // Deshabilitar días anteriores a hoy
    if(cellDate < today) {
      dayCell.classList.add('disabled');
    }

    dayCell.addEventListener('click', () => {
      if(dayCell.classList.contains('disabled')) return;
      selectDay(day, cellDate);
    });

    daysContainer.appendChild(dayCell);
  }
}

function selectDay(day, dateObj) {
  selectedDay = dateObj;
  selectedTime = null;
  selectedDateHeader.textContent = `Seleccionó: ${formatDate(selectedDay)}`;

  // Resaltar día seleccionado
  document.querySelectorAll('.day').forEach(d => d.classList.remove('selected'));
  const dayCells = Array.from(document.querySelectorAll('.day'));
  const index = day + new Date(selectedDay.getFullYear(), selectedDay.getMonth(), 1).getDay() - 1;
  if(dayCells[index]) dayCells[index].classList.add('selected');

  loadAvailableSlots();
  confirmationBox.style.display = 'none';
}

function formatDate(date) {
  const opts = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
  return date.toLocaleDateString('es-ES', opts);
}

function loadAvailableSlots() {
  morningSlotsContainer.innerHTML = '';
  afternoonSlotsContainer.innerHTML = '';
  if(!doctorSelect.value || !selectedDay) return;

  // Obtener disponibilidad simulada
  const dateStr = selectedDay.toISOString().split('T')[0];
  const availability = simulateAvailability(doctorSelect.value, dateStr);

  // Crear botones para cada slot
  availability.morning.forEach(slot => {
    const btn = createSlotButton(slot);
    morningSlotsContainer.appendChild(btn);
  });
  availability.afternoon.forEach(slot => {
    const btn = createSlotButton(slot);
    afternoonSlotsContainer.appendChild(btn);
  });
}

function createSlotButton(slot) {
  const btn = document.createElement('div');
  btn.textContent = slot.time;
  btn.classList.add('time-slot');

  if(slot.available) {
    btn.classList.add('available');
    btn.addEventListener('click', () => selectTimeSlot(slot.time, btn));
  } else {
    btn.classList.add('unavailable');
  }
  return btn;
}

function selectTimeSlot(time, btnElement) {
  // Deseleccionar previos
  document.querySelectorAll('.time-slot.selected').forEach(el => el.classList.remove('selected'));

  // Marcar nuevo seleccionado
  btnElement.classList.add('selected');
  selectedTime = time;

  // Mostrar confirmación
  showConfirmation();
}

function showConfirmation() {
  if(!selectedDay || !selectedTime) {
    confirmationBox.style.display = 'none';
    return;
  }
  selectedSlotInfo.textContent = `Cita para el ${formatDate(selectedDay)} a las ${selectedTime}`;
  confirmationBox.style.display = 'block';
}

function confirmAppointment() {
  // Aquí puedes enviar datos a servidor o hacer lo que necesites
  // Por ahora redirigimos a página de confirmación con datos en URL
  const dateStr = selectedDay.toISOString().split('T')[0];
  const time = selectedTime.replace(':','');
  const doctor = encodeURIComponent(doctorSelect.value);
  window.location.href = `confirmacion.html?doctor=${doctor}&date=${dateStr}&time=${time}`;
}

// Eventos
specialtySelect.addEventListener('change', () => {
  fillDoctorOptions();
  clearSelection();
});

doctorSelect.addEventListener('change', () => {
  clearSelection();
});

prevMonthBtn.addEventListener('click', () => {
  currentDate.setMonth(currentDate.getMonth() -1);
  renderCalendar();
  clearSelection();
});

nextMonthBtn.addEventListener('click', () => {
  currentDate.setMonth(currentDate.getMonth() +1);
  renderCalendar();
  clearSelection();
});

// Inicializar
fillDoctorOptions();
renderCalendar();

    </script>
</body>
</html>
